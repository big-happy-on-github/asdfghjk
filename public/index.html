<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The States of Lim</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body onload="setup()">
    <div class="container">
        <h1>The States of Lim</h1>
        <p id="subheading"></p>
        <p>
            To add Netlify Functions, create a JavaScript, TypeScript, or Go function to your project in a <code>netlify/functions</code> directory. You can customize the address for your functions using Netlify's Redirects API.
        </p>
        <h2>Examples</h2>
        <ul>
            <li><a href="/.netlify/functions/hello?name=you">Hello World</a> ( /.netlify/functions/hello?name=you )</li>
            <li><a href="/api/hello?name=you">Hello World</a> ( /api/hello?name=you )</li>
        </ul>

        <h2>More information</h2>
        <ul>
            <li><a href="https://www.netlify.com/products/functions/?utm_campaign=dx-examples&utm_source=example-site&utm_medium=web&utm_content=example-hello-functions">About Netlify Functions</a></li>
            <li><a href="https://docs.netlify.com/functions/overview/?utm_campaign=dx-examples&utm_source=example-site&utm_medium=web&utm_content=example-hello-functions">Docs: Netlify Functions</a></li>
            <li><a href="https://docs.netlify.com/functions/logs/?utm_campaign=dx-examples&utm_source=example-site&utm_medium=web&utm_content=example-hello-functions">Accessing your function logs</a></li>
            <li><a href="https://functions.netlify.com/?utm_campaign=dx-examples&utm_source=example-site&utm_medium=web&utm_content=example-hello-functions">Learn serverless in the functions playground</a></li>
        </ul>

        <h2>Deploy your own</h2>
        <p>
            A great place to start is to clone and deploy your own copy of this example. You can do that by clicking the button below.
        </p>
        <p>
            Try it! ðŸ‘‰
            <a href="https://app.netlify.com/start/deploy?repository=https://github.com/netlify/example-hello-world-functions&utm_campaign=dx-examples"><img src="https://www.netlify.com/img/deploy/button.svg" class="dtn" alt="Deploy to Netlify"></a>
        </p>

        <p><small>Clicking the button will clone <a href="https://github.com/netlify/example-hello-world-functions">this repo</a> and deploy it as a new site on <a href="https://netlify.com/?utm_campaign=dx-examples">Netlify</a></small></p>
    </div>

    <script>
        let id;
        
        function generateRandomCode(length) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:,.<>?';
            let randomCode = '';
            const charactersLength = characters.length;
            
            for (let i = 0; i < length; i++) {
                randomCode += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            
            return randomCode;
        }
        
        async function fetchData(httpMethod, data = false) {
            let options = {
                method: httpMethod,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            if (httpMethod === "POST") {
                options.body = JSON.stringify(data);
            }
        
            try {
                const response = await fetch(`/.netlify/functions/public?id=${id}`, options);
                const responseData = await response.json();
                return responseData;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function setup() {
            id = localStorage.getItem("id");
            
            if (!id) {
                id = generateRandomCode(4);
                localStorage.setItem("id", id);
                console.log(id);
            }

            const data = await fetchData("GET", id);
            if (data) {
                document.getElementById("subheading").textContent = `User ${id}, Level ${data.lvl}`;
            }
        }
    </script>
</body>
</html>
